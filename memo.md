# 技術メモ

powershellスクリプト自体はAIが生成してくれたので簡単だった。

難しかったのはインストール用のバッチファイルで
最初はutf-8で作成して、冒頭に

    @echo off
    chcp 65001 >nul

と書いて、utf-8のスクリプトを認識させようとしたが、
テスト用のWindows機でダウンロードして実行すると、
文字化けした文字列とともに「内部コマンドまたは外部コマンド、操作可能なプログラムまたはバッチファイルとして認識されていません」というエラーが出て困ってしまった。

文字化けしているので文字コードをBOM付きのUTF-8にしたり、Shift-JISにして`chcp 65001 >nul`を消したりしてみたが、
SHIFT-JISにすると文字化けは直るものの、エラーメッセージはそのまま。

しかも、このスクリプトを作成したWindowsマシンで実行してもエラーは出ないのだ。

おかしいと思ってダウンロードしたファイルをよく見たら、作成時には改行コードがCRLFなのに、githubの「Download Zip」からダウンロードしたファイルは「LF」になっている。
そういえばgitには自動的に改行コードを調節する機能があった。その結果、`cmd.exe`がバッチファイルの改行を認識できず、それによりREMによるコメントなどが効かない状態になっていたので、おかしなエラーが出たのだ。
このツールは、あくまでプログラマではない人に使ってもらうため、gitを使わず、githubのDownload Zipでダウンロードしてもらおうと思ったが、それが結果的に問題を起こしたわけだ。

gitの自動的な改行コード変換の機能をdisableするために

    git config core.autocrlf false

にしてコミットしなおしたら、エラーは消えた。

ただし上記の設定はwindowsと非windowsの両方で開発をしようとすると問題が起こるので普通はしない。

というかいまだに改行コードが違うだけで認識できなかったり、改行が認識できないとおかしな挙動になるWindowsが悪いと思う。
